<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#000000">	
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MotoManuten√ß√£o - Controle para Motoboys</title>
    <meta name="theme-color" content="#006400">
    <meta name="description" content="Aplicativo para motoboys controlarem a manuten√ß√£o de suas motos">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MotoManuten√ß√£o">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #006400;
            --secondary-color: #ff8c00;
            --light-color: #f5f5f5;
            --dark-color: #333;
        }
        
        /* Estilos da Tela de Login */
        #loginScreen {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-container {
            max-width: 400px;
            width: 100%;
            padding: 20px;
        }
        
        .login-card {
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border: none;
            overflow: hidden;
        }
        
        .login-header {
            background-color: var(--primary-color);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .login-body {
            padding: 30px;
            background-color: white;
        }
        
        .password-toggle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
        }
        
        .password-toggle:hover {
            color: var(--primary-color);
        }
        
        .password-container {
            position: relative;
        }
        
        .login-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        .logo {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .forgot-password {
            text-align: right;
            margin-top: 10px;
        }
        
        .forgot-password a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .forgot-password a:hover {
            text-decoration: underline;
        }
        
        .register-link {
            margin-top: 15px;
            text-align: center;
        }
        
        .register-link a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }
        
        .register-link a:hover {
            text-decoration: underline;
        }

        /* Estilos do Aplicativo Principal */
        #appScreen {
            display: none;
        }
        
        body.app-loaded {
            background-color: #f8f9fa;
            padding-bottom: 80px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--primary-color);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: #004d00;
            border-color: #004d00;
        }
        
        .btn-warning {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            background-color: var(--primary-color);
            color: white;
        }
        
        .main-tabs .nav-link {
            color: var(--dark-color);
            font-weight: 500;
        }
        
        .main-tabs .nav-link.active {
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 3px solid var(--primary-color);
            background: transparent;
        }
        
        .service-badge {
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .stats-card {
            text-align: center;
            padding: 15px;
        }
        
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .floating-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .service-item {
            border-left: 4px solid var(--primary-color);
            transition: transform 0.2s;
        }
        
        .service-item:hover {
            transform: translateX(5px);
        }
        
        .maintenance-due {
            border-left: 4px solid #dc3545;
        }
        
        .maintenance-soon {
            border-left: 4px solid #ffc107;
        }
        
        .cost-summary {
            background: linear-gradient(135deg, #006400 0%, #008000 100%);
            color: white;
            border-radius: 10px;
        }
        
        .motorcycle-img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }
        
        .vehicle-selector {
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .vehicle-selector:hover, .vehicle-selector.active {
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .vehicle-selector.active {
            border: 2px solid var(--primary-color);
        }
        
        .delete-vehicle-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #dc3545;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }
        
        .delete-vehicle-btn:hover {
            opacity: 1;
        }
        
        .chart-container {
            height: 250px;
        }
        
        .maintenance-config-item {
            border-left: 4px solid #6c757d;
            padding-left: 10px;
            margin-bottom: 10px;
        }

        .user-menu {
            color: white;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="logo">
                        <i class="fas fa-motorcycle"></i>
                    </div>
                    <h2>MotoManuten√ß√£o</h2>
                    <p class="mb-0">Controle de manuten√ß√£o para motoboys</p>
                </div>
                <div class="login-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="email" class="form-label">E-mail</label>
                            <input type="email" class="form-control" id="email" placeholder="seu@email.com" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label">Senha</label>
                            <div class="password-container">
                                <input type="password" class="form-control" id="password" placeholder="Sua senha" required>
                                <button type="button" class="password-toggle" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="forgot-password">
                            <a href="#" id="forgotPassword">Esqueci minha senha</a>
                        </div>
                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">Entrar</button>
                        </div>
                    </form>
                    <div class="register-link">
                        <p>N√£o tem uma conta? <a href="#" id="registerLink">Cadastre-se</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Aplicativo Principal (inicialmente oculto) -->
    <div id="appScreen">
        <!-- Barra de navega√ß√£o -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-motorcycle me-2"></i>MotoManuten√ß√£o
                </a>
                <div class="d-flex">
                    <button class="btn btn-outline-light me-2" id="contrastToggle">
                        <i class="fas fa-adjust"></i>
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i>
                            <span id="userName">Usu√°rio</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Sair</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- Seletor de Ve√≠culos -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Meus Ve√≠culos</h5>
                </div>
                <div class="card-body">
                    <div class="row" id="vehiclesList">
                        <!-- Ve√≠culos ser√£o carregados aqui -->
                    </div>
                    <div class="text-center mt-3">
                        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
                            <i class="fas fa-plus me-1"></i>Adicionar Ve√≠culo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Abas principais -->
            <ul class="nav nav-tabs main-tabs mb-4" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab">In√≠cio</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="services-tab" data-bs-toggle="tab" data-bs-target="#services" type="button" role="tab">Servi√ßos</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab">Estat√≠sticas</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button" role="tab">Configura√ß√µes</button>
                </li>
            </ul>

            <!-- Conte√∫do das abas -->
            <div class="tab-content" id="mainTabsContent">
                <!-- Aba In√≠cio -->
                <div class="tab-pane fade show active" id="home" role="tabpanel">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0" id="currentVehicleTitle">Minha Moto</h5>
                                </div>
                                <div class="card-body">
                                    <div class="text-center mb-3">
                                        <img src="https://cdn-icons-png.flaticon.com/512/3073/3073471.png" alt="Moto" class="motorcycle-img" style="max-height: 150px;">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Modelo</label>
                                        <input type="text" class="form-control" id="bikeModel">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Ano</label>
                                        <input type="number" class="form-control" id="bikeYear">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Placa</label>
                                        <input type="text" class="form-control" id="bikePlate">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Quilometragem atual</label>
                                        <input type="number" class="form-control" id="currentMileage">
                                    </div>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" id="saveBikeInfo">Salvar Informa√ß√µes</button>
                                        <button class="btn btn-outline-danger" id="resetVehicleBtn">Resetar Hist√≥rico</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Pr√≥ximas Manuten√ß√µes</h5>
                                </div>
                                <div class="card-body" id="maintenanceAlerts">
                                    <!-- Alertas de manuten√ß√£o ser√£o carregados aqui -->
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Hist√≥rico Recente</h5>
                                </div>
                                <div class="card-body">
                                    <div id="recentServices">
                                        <!-- Servi√ßos recentes ser√£o carregados aqui -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba Servi√ßos -->
                <div class="tab-pane fade" id="services" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Registrar Novo Servi√ßo</h5>
                        </div>
                        <div class="card-body">
                            <form id="serviceForm">
                                <div class="mb-3">
                                    <label class="form-label">Tipo de Servi√ßo</label>
                                    <select class="form-select" id="serviceType" required>
                                        <option value="">Selecione o tipo de servi√ßo</option>
                                        <option value="Troca de √≥leo">Troca de √≥leo</option>
                                        <option value="Troca de pneu">Troca de pneu</option>
                                        <option value="Ajuste de freios">Ajuste de freios</option>
                                        <option value="Troca de correia">Troca de correia</option>
                                        <option value="Revis√£o geral">Revis√£o geral</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Data do Servi√ßo</label>
                                    <input type="date" class="form-control" id="serviceDate" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Quilometragem</label>
                                    <input type="number" class="form-control" id="serviceMileage" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Custo (R$)</label>
                                    <input type="number" class="form-control" id="serviceCost" step="0.01">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Observa√ß√µes</label>
                                    <textarea class="form-control" id="serviceNotes" rows="2"></textarea>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Registrar Servi√ßo</button>
                            </form>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Hist√≥rico de Servi√ßos</h5>
                            <div>
                                <input type="text" class="form-control form-control-sm" placeholder="Buscar..." id="serviceSearch">
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="list-group" id="servicesList">
                                <!-- Servi√ßos ser√£o carregados aqui -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba Estat√≠sticas -->
                <div class="tab-pane fade" id="stats" role="tabpanel">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card stats-card">
                                <div class="card-body">
                                    <i class="fas fa-tachometer-alt fa-2x mb-2 text-primary"></i>
                                    <h3 class="stats-number" id="totalMileage">0</h3>
                                    <p class="card-text">Quil√¥metros rodados</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stats-card">
                                <div class="card-body">
                                    <i class="fas fa-tools fa-2x mb-2 text-primary"></i>
                                    <h3 class="stats-number" id="totalServices">0</h3>
                                    <p class="card-text">Servi√ßos realizados</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card stats-card">
                                <div class="card-body">
                                    <i class="fas fa-money-bill-wave fa-2x mb-2 text-primary"></i>
                                    <h3 class="stats-number" id="totalCost">R$ 0</h3>
                                    <p class="card-text">Total gasto</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Custos por Categoria</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="costChart" height="250"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-body cost-summary">
                            <h5 class="card-title">Resumo de Custos</h5>
                            <div class="row">
                                <div class="col-6">
                                    <p>M√©dia mensal:</p>
                                    <h4 id="monthlyAverage">R$ 0,00</h4>
                                </div>
                                <div class="col-6">
                                    <p>Pr√≥xima revis√£o:</p>
                                    <h4 id="nextMaintenance">0 km</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aba Configura√ß√µes -->
                <div class="tab-pane fade" id="config" role="tabpanel">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Configura√ß√µes de Manuten√ß√£o</h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted">Defina os intervalos de quilometragem para cada tipo de servi√ßo. O sistema ir√° alertar quando estiver pr√≥ximo da pr√≥xima manuten√ß√£o.</p>
                            
                            <div id="maintenanceConfig">
                                <!-- Configura√ß√µes de manuten√ß√£o ser√£o carregadas aqui -->
                            </div>
                            
                            <div class="mt-3">
                                <button class="btn btn-primary" id="saveMaintenanceConfig">
                                    <i class="fas fa-save me-1"></i>Salvar Configura√ß√µes
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Gerenciar Ve√≠culos</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                Selecione um ve√≠culo para exclu√≠-lo permanentemente. Esta a√ß√£o n√£o pode ser desfeita.
                            </div>
                            
                            <div class="list-group" id="vehicleManagementList">
                                <!-- Lista de ve√≠culos para gerenciamento -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bot√£o flutuante para adicionar servi√ßo -->
        <div class="floating-btn" data-bs-toggle="modal" data-bs-target="#addServiceModal">
            <i class="fas fa-plus"></i>
        </div>

        <!-- Navega√ß√£o inferior -->
        <div class="bottom-nav">
            <div class="container">
                <div class="d-flex justify-content-around py-2">
                    <button class="btn btn-link text-dark" onclick="switchTab('home')">
                        <i class="fas fa-home fa-lg"></i>
                        <br>
                        <small>In√≠cio</small>
                    </button>
                    <button class="btn btn-link text-dark" onclick="switchTab('services')">
                        <i class="fas fa-tools fa-lg"></i>
                        <br>
                        <small>Servi√ßos</small>
                    </button>
                    <button class="btn btn-link text-dark" onclick="switchTab('stats')">
                        <i class="fas fa-chart-bar fa-lg"></i>
                        <br>
                        <small>Estat√≠sticas</small>
                    </button>
                    <button class="btn btn-link text-dark" onclick="switchTab('config')">
                        <i class="fas fa-cog fa-lg"></i>
                        <br>
                        <small>Configura√ß√µes</small>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modais (mantidos do c√≥digo original) -->
    <!-- Modal para adicionar ve√≠culo -->
    <div class="modal fade" id="addVehicleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Novo Ve√≠culo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="vehicleForm">
                        <div class="mb-3">
                            <label class="form-label">Nome do Ve√≠culo</label>
                            <input type="text" class="form-control" id="vehicleName" required placeholder="Ex: CG 160 Titan">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modelo</label>
                            <input type="text" class="form-control" id="vehicleModel" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ano</label>
                            <input type="number" class="form-control" id="vehicleYear" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Placa</label>
                            <input type="text" class="form-control" id="vehiclePlate">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quilometragem atual</label>
                            <input type="number" class="form-control" id="vehicleMileage" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveVehicleBtn">Salvar Ve√≠culo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar servi√ßo (para mobile) -->
    <div class="modal fade" id="addServiceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Registrar Novo Servi√ßo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="mobileServiceForm">
                        <div class="mb-3">
                            <label class="form-label">Tipo de Servi√ßo</label>
                            <select class="form-select" id="mobileServiceType" required>
                                <option value="">Selecione o tipo de servi√ßo</option>
                                <option value="Troca de √≥leo">Troca de √≥leo</option>
                                <option value="Troca de pneu">Troca de pneu</option>
                                <option value="Ajuste de freios">Ajuste de freios</option>
                                <option value="Troca de correia">Troca de correia</option>
                                <option value="Revis√£o geral">Revis√£o geral</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Data do Servi√ßo</label>
                            <input type="date" class="form-control" id="mobileServiceDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Quilometragem</label>
                            <input type="number" class="form-control" id="mobileServiceMileage" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Custo (R$)</label>
                            <input type="number" class="form-control" id="mobileServiceCost" step="0.01">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="addServiceFromMobile()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirma√ß√£o para resetar hist√≥rico -->
    <div class="modal fade" id="resetConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Reset</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja resetar o hist√≥rico deste ve√≠culo? Todos os servi√ßos registrados ser√£o exclu√≠dos permanentemente. Esta a√ß√£o n√£o pode ser desfeita.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmResetBtn">Resetar Hist√≥rico</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirma√ß√£o para excluir ve√≠culo -->
    <div class="modal fade" id="deleteVehicleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Exclus√£o</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja excluir este ve√≠culo? Todos os dados, incluindo servi√ßos registrados, ser√£o exclu√≠dos permanentemente. Esta a√ß√£o n√£o pode ser desfeita.</p>
                    <p class="fw-bold" id="vehicleToDeleteName"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteVehicleBtn">Excluir Ve√≠culo</button>
                </div>
            </div>
        </div>
    </div>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script> 
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // ========== SISTEMA DE LOGIN ==========

    let authToken = localStorage.getItem('token');

    document.addEventListener('DOMContentLoaded', function() {
        checkLoginStatus();
        setupLoginEvents();
    });

    function checkLoginStatus() {
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        if (authToken && user.name) {
            showAppScreen(user.name);
        } else {
            showLoginScreen();
        }
    }

    function setupLoginEvents() {
        const togglePassword = document.getElementById('togglePassword');
        const passwordInput = document.getElementById('password');
        if (togglePassword && passwordInput) {
            togglePassword.addEventListener('click', function() {
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                this.innerHTML = type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            });
        }

        const loginForm = document.getElementById('loginForm');
        if (loginForm) {
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;

                if (!email || !password) {
                    alert('Por favor, preencha todos os campos.');
                    return;
                }

                try {
                    const result = await apiRequest('/auth/login', {
                        method: 'POST',
                        body: JSON.stringify({ email, password })
                    });

                    if (result && result.ok) {
                        authToken = result.data.token;
                        localStorage.setItem('token', authToken);
                        localStorage.setItem('user', JSON.stringify(result.data.user));
                        showAppScreen(result.data.user.name);
                        loginForm.reset();
                    } else {
                        alert(result?.data?.error || 'Erro no login');
                    }
                } catch (error) {
                    alert('Erro de conex√£o com o servidor');
                }
            });
        }

        const registerLink = document.getElementById('registerLink');
        if (registerLink) {
            registerLink.addEventListener('click', async function(e) {
                e.preventDefault();
                const name = prompt('Digite seu nome:');
                const email = prompt('Digite seu e-mail:');
                const password = prompt('Crie uma senha (m√≠nimo 6 caracteres):');

                if (name && email && password) {
                    if (password.length < 6) {
                        alert('Senha deve ter pelo menos 6 caracteres.');
                        return;
                    }

                    try {
                        const result = await apiRequest('/auth/register', {
                            method: 'POST',
                            body: JSON.stringify({ name, email, password })
                        });

                        if (result && result.ok) {
                            authToken = result.data.token;
                            localStorage.setItem('token', authToken);
                            localStorage.setItem('user', JSON.stringify(result.data.user));
                            showAppScreen(result.data.user.name);
                            alert('Cadastro realizado com sucesso!');
                        } else {
                            alert(result?.data?.error || 'Erro no cadastro');
                        }
                    } catch (error) {
                        alert('Erro de conex√£o com o servidor');
                    }
                }
            });
        }

        const forgotPassword = document.getElementById('forgotPassword');
        if (forgotPassword) {
            forgotPassword.addEventListener('click', function(e) {
                e.preventDefault();
                alert('Funcionalidade de recupera√ß√£o de senha seria implementada aqui.');
            });
        }
    }

    function showLoginScreen() {
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('appScreen').style.display = 'none';
        document.body.classList.remove('app-loaded');
    }

    function showAppScreen(userName) {
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('appScreen').style.display = 'block';
        document.body.classList.add('app-loaded');
        document.getElementById('userName').textContent = userName;
        initializeApp();
    }

    function logout() {
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        authToken = null;
        showLoginScreen();
    }

    // ========== FUN√á√ÉO DE REQUISI√á√ÉO PARA O BACKEND ==========
    async function apiRequest(endpoint, options = {}) {
        const config = {
            method: options.method || 'GET',
            headers: {
                'Content-Type': 'application/json',
                ...options.headers
            },
            body: options.body
        };

        if (authToken) {
            config.headers.Authorization = `Bearer ${authToken}`;
        }

        try {
            // **URL relativa** evita problemas de CORS local
            const response = await fetch(`/api${endpoint}`, config);

            if (response.status === 401) {
                logout();
                return null;
            }

            const data = await response.json();
            return { ok: response.ok, data };
        } catch (error) {
            console.error('Erro na requisi√ß√£o:', error);
            return { ok: false, data: { error: 'Erro de conex√£o' } };
        }
    }

    // ========== REGISTRAR SERVICE WORKER ==========
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
            .then(reg => console.log('SW registered:', reg))
            .catch(err => console.log('SW registration failed:', err));
    }
    
    
        // ========== APLICATIVO PRINCIPAL ==========
        // Dados iniciais do aplicativo
        let vehicles = [];
        let currentVehicleId = null;
        let services = [];
        let costChart = null;
        let maintenanceConfig = {};

        // Configura√ß√µes padr√£o de manuten√ß√£o preventiva
        const defaultMaintenanceIntervals = {
            "Troca de √≥leo": 5000,
            "Troca de pneu": 10000,
            "Ajuste de freios": 7000,
            "Troca de correia": 15000,
            "Revis√£o geral": 10000,
            "Outro": 0
        };

        // Cores para o gr√°fico (uma para cada tipo de servi√ßo)
        const chartColors = [
            'rgba(0, 100, 0, 0.7)',      // Verde
            'rgba(255, 140, 0, 0.7)',    // Laranja
            'rgba(50, 50, 200, 0.7)',    // Azul
            'rgba(200, 50, 50, 0.7)',    // Vermelho
            'rgba(150, 50, 200, 0.7)',   // Roxo
            'rgba(50, 150, 150, 0.7)'    // Ciano
        ];
        // ========== CONFIGURA√á√ÉO DA API ==========
        

	// üîÑ Fun√ß√£o para carregar ve√≠culos do banco via API
	async function loadVehiclesFromAPI() {
  	const result = await apiRequest('/vehicles');
  	if (result && result.ok) {
    	vehicles = result.data;
    	renderVehiclesList();
    	renderVehicleManagementList();
  	} else {
    	console.error(result?.data?.error || 'Erro ao carregar ve√≠culos');
  	}
	}
        
           // Fun√ß√£o para fazer requisi√ß√µes autenticadas

	async function initializeApp() {
  	  // Configurar data atual como padr√£o para o formul√°rio
  	  const today = new Date().toISOString().split('T')[0];
  	  document.getElementById('serviceDate').value = today;
   	 document.getElementById('mobileServiceDate').value = today;

   	 // üîÑ Agora os ve√≠culos v√™m do banco, n√£o do localStorage
   	 await loadVehiclesFromAPI();

   	 // Inicializar event listeners
   	 setupEventListeners();
	
          
            // Inicializar event listeners
            setupEventListeners();
            
            // Se n√£o houver ve√≠culos, criar um padr√£o
            if (vehicles.length === 0) {
                createDefaultVehicle();
            } else {
                // Selecionar o primeiro ve√≠culo
                selectVehicle(vehicles[0].id);
            }
            
            // Carregar configura√ß√µes de manuten√ß√£o
            loadMaintenanceConfig();
            
            // Configurar bot√£o de logout
            document.getElementById('logoutBtn').addEventListener('click', logout);
        }

        // O restante do c√≥digo do aplicativo permanece igual...
        // [Todo o c√≥digo JavaScript do aplicativo original aqui]
        // Configurar event listeners
        function setupEventListeners() {
            // Formul√°rio de servi√ßo (vers√£o desktop)
            document.getElementById('serviceForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addServiceFromForm();
            });
            
            // Bot√£o de salvar ve√≠culo
            document.getElementById('saveVehicleBtn').addEventListener('click', addNewVehicle);
            
            // Bot√£o de salvar informa√ß√µes do ve√≠culo
            document.getElementById('saveBikeInfo').addEventListener('click', saveVehicleInfo);
            
            // Bot√£o de resetar hist√≥rico
            document.getElementById('resetVehicleBtn').addEventListener('click', function() {
                const modal = new bootstrap.Modal(document.getElementById('resetConfirmModal'));
                modal.show();
            });
            
            // Confirma√ß√£o de reset
            document.getElementById('confirmResetBtn').addEventListener('click', resetVehicleHistory);
            
            // Busca de servi√ßos
            document.getElementById('serviceSearch').addEventListener('input', handleSearch);
            
            // Alternar modo de alto contraste
            document.getElementById('contrastToggle').addEventListener('click', toggleContrastMode);
            
            // Salvar configura√ß√µes de manuten√ß√£o
            document.getElementById('saveMaintenanceConfig').addEventListener('click', saveMaintenanceConfig);
            
            // Confirma√ß√£o de exclus√£o de ve√≠culo
            document.getElementById('confirmDeleteVehicleBtn').addEventListener('click', deleteVehicle);
        }

        // Carregar dados salvos
        function loadSavedData() {
            const savedVehicles = localStorage.getItem('motoVehicles');
            if (savedVehicles) {
                vehicles = JSON.parse(savedVehicles);
            }
            
            const savedServices = localStorage.getItem('motoServices');
            if (savedServices) {
                services = JSON.parse(savedServices);
            }
            
            const lastVehicleId = localStorage.getItem('currentVehicleId');
            if (lastVehicleId) {
                currentVehicleId = lastVehicleId;
            }
            
            // Carregar prefer√™ncia de contraste
            if (localStorage.getItem('highContrast') === 'true') {
                document.body.classList.add('high-contrast');
            }
        }

        // Carregar configura√ß√µes de manuten√ß√£o
        function loadMaintenanceConfig() {
            const savedConfig = localStorage.getItem('maintenanceConfig');
            if (savedConfig) {
                maintenanceConfig = JSON.parse(savedConfig);
            } else {
                // Usar configura√ß√µes padr√£o
                maintenanceConfig = {...defaultMaintenanceIntervals};
                localStorage.setItem('maintenanceConfig', JSON.stringify(maintenanceConfig));
            }
            
            renderMaintenanceConfig();
        }

        // Renderizar configura√ß√µes de manuten√ß√£o
        function renderMaintenanceConfig() {
            const configContainer = document.getElementById('maintenanceConfig');
            configContainer.innerHTML = '';
            
            for (const [type, interval] of Object.entries(maintenanceConfig)) {
                if (type === "Outro") continue; // N√£o mostrar configura√ß√£o para "Outro"
                
                const configItem = document.createElement('div');
                configItem.className = 'maintenance-config-item';
                configItem.innerHTML = `
                    <label class="form-label">${type} (a cada quantos km?)</label>
                    <div class="input-group mb-2">
                        <input type="number" class="form-control maintenance-interval" data-type="${type}" value="${interval}" min="0">
                        <span class="input-group-text">km</span>
                    </div>
                `;
                
                configContainer.appendChild(configItem);
            }
            
            // Renderizar lista de ve√≠culos para gerenciamento
            renderVehicleManagementList();
        }

        // Renderizar lista de ve√≠culos para gerenciamento
        function renderVehicleManagementList() {
            const managementList = document.getElementById('vehicleManagementList');
            managementList.innerHTML = '';
            
            if (vehicles.length === 0) {
                managementList.innerHTML = '<p class="text-center text-muted">Nenhum ve√≠culo cadastrado.</p>';
                return;
            }
            
            vehicles.forEach(vehicle => {
                const listItem = document.createElement('div');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.innerHTML = `
                    <div>
                        <h6 class="mb-1">${vehicle.name}</h6>
                        <small class="text-muted">${vehicle.model} - ${vehicle.plate || 'Sem placa'}</small>
                    </div>
                    <button class="btn btn-outline-danger btn-sm" onclick="confirmDeleteVehicle('${vehicle.id}')">
                        <i class="fas fa-trash"></i> Excluir
                    </button>
                `;
                
                managementList.appendChild(listItem);
            });
        }

        // Salvar configura√ß√µes de manuten√ß√£o
        function saveMaintenanceConfig() {
            const intervalInputs = document.querySelectorAll('.maintenance-interval');
            
            intervalInputs.forEach(input => {
                const type = input.dataset.type;
                const interval = parseInt(input.value) || 0;
                maintenanceConfig[type] = interval;
            });
            
            localStorage.setItem('maintenanceConfig', JSON.stringify(maintenanceConfig));
            updateMaintenanceAlerts();
            
            alert('Configura√ß√µes salvas com sucesso!');
        }

        // Confirmar exclus√£o de ve√≠culo
        function confirmDeleteVehicle(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            document.getElementById('vehicleToDeleteName').textContent = `${vehicle.name} (${vehicle.model})`;
            
            // Armazenar o ID do ve√≠culo a ser exclu√≠do em um atributo do bot√£o
            document.getElementById('confirmDeleteVehicleBtn').dataset.vehicleId = vehicleId;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteVehicleModal'));
            modal.show();
        }

        // Excluir ve√≠culo
        function deleteVehicle() {
            const vehicleId = document.getElementById('confirmDeleteVehicleBtn').dataset.vehicleId;
            
            // Remover ve√≠culo da lista
            vehicles = vehicles.filter(v => v.id !== vehicleId);
            
            // Remover servi√ßos associados ao ve√≠culo
            services = services.filter(s => s.vehicleId !== vehicleId);
            
            // Salvar altera√ß√µes
            saveVehiclesToStorage();
            localStorage.setItem('motoServices', JSON.stringify(services));
            
            // Fechar o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('deleteVehicleModal'));
            modal.hide();
            
            // Se era o ve√≠culo atual, selecionar outro (se houver)
            if (currentVehicleId === vehicleId) {
                if (vehicles.length > 0) {
                    selectVehicle(vehicles[0].id);
                } else {
                    currentVehicleId = null;
                    createDefaultVehicle();
                }
            }
            
            // Atualizar listas
            renderVehiclesList();
            renderVehicleManagementList();
            
            alert('Ve√≠culo exclu√≠do com sucesso!');
        }

        // Criar ve√≠culo padr√£o se n√£o houver nenhum
        function createDefaultVehicle() {
            const defaultVehicle = {
                id: Date.now().toString(),
                name: "Minha Moto",
                model: "Honda CG 160 Titan",
                year: 2020,
                plate: "ABC1D23",
                mileage: 18500
            };
            
            vehicles.push(defaultVehicle);
            currentVehicleId = defaultVehicle.id;
            saveVehiclesToStorage();
            renderVehiclesList();
            renderVehicleManagementList();
            loadVehicleData(currentVehicleId);
        }

        // Adicionar novo ve√≠culo
        async function addNewVehicle() {
 	   const name = document.getElementById('vehicleName').value.trim();
 	   const model = document.getElementById('vehicleModel').value.trim();
	   const year = document.getElementById('vehicleYear').value;
 	   const plate = document.getElementById('vehiclePlate').value.trim();
 	   const mileage = document.getElementById('vehicleMileage').value;

  	   if (!name || !model || !year || !mileage) {
   	    alert('Por favor, preencha todos os campos obrigat√≥rios.');
  	    return;
 	   }

       	  const result = await apiRequest('/vehicles', {
  	    method: 'POST',
  	    body: JSON.stringify({ name, model, year, plate, mileage }),
 	  });

 	 if (result && result.ok) {
	    alert('Ve√≠culo adicionado com sucesso!');
 	    await loadVehiclesFromAPI();
	  } else {
 	    alert(result.data?.error || 'Erro ao adicionar ve√≠culo');
	  }

 	 const modal = bootstrap.Modal.getInstance(document.getElementById('addVehicleModal'));
	 modal.hide();
	 document.getElementById('vehicleForm').reset();
	}


        // Renderizar lista de ve√≠culos
        function renderVehiclesList() {
            const vehiclesList = document.getElementById('vehiclesList');
            vehiclesList.innerHTML = '';
            
            vehicles.forEach(vehicle => {
                const vehicleElement = document.createElement('div');
                vehicleElement.className = `col-md-4 mb-3 vehicle-selector ${vehicle.id === currentVehicleId ? 'active' : ''}`;
                vehicleElement.innerHTML = `
                    <div class="card h-100" onclick="selectVehicle('${vehicle.id}')">
                        <button class="delete-vehicle-btn" onclick="event.stopPropagation(); confirmDeleteVehicle('${vehicle.id}')">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="card-body text-center">
                            <i class="fas fa-motorcycle fa-2x mb-2"></i>
                            <h6 class="card-title">${vehicle.name}</h6>
                            <p class="card-text small">${vehicle.model}<br>${vehicle.plate || 'Sem placa'}</p>
                        </div>
                    </div>
                `;
                
                vehiclesList.appendChild(vehicleElement);
            });
        }

        // Selecionar ve√≠culo
        function selectVehicle(vehicleId) {
            currentVehicleId = vehicleId;
            localStorage.setItem('currentVehicleId', vehicleId);
            renderVehiclesList();
            loadVehicleData(vehicleId);
        }

        // Carregar dados do ve√≠culo selecionado
        function loadVehicleData(vehicleId) {
            const vehicle = vehicles.find(v => v.id === vehicleId);
            if (!vehicle) return;
            
            // Preencher formul√°rio de informa√ß√µes
            document.getElementById('currentVehicleTitle').textContent = vehicle.name;
            document.getElementById('bikeModel').value = vehicle.model;
            document.getElementById('bikeYear').value = vehicle.year;
            document.getElementById('bikePlate').value = vehicle.plate || '';
            document.getElementById('currentMileage').value = vehicle.mileage;
            
            // Atualizar servi√ßos e estat√≠sticas
            updateServicesList();
            updateStats();
            updateMaintenanceAlerts();
            updateRecentServices();
        }

        // Salvar informa√ß√µes do ve√≠culo
        function saveVehicleInfo() {
            const vehicleIndex = vehicles.findIndex(v => v.id === currentVehicleId);
            if (vehicleIndex === -1) return;
            
            vehicles[vehicleIndex].model = document.getElementById('bikeModel').value;
            vehicles[vehicleIndex].year = document.getElementById('bikeYear').value;
            vehicles[vehicleIndex].plate = document.getElementById('bikePlate').value;
            const newMileage = parseInt(document.getElementById('currentMileage').value);
            
            // Atualizar a quilometragem apenas se for maior que a anterior
            if (newMileage >= vehicles[vehicleIndex].mileage) {
                vehicles[vehicleIndex].mileage = newMileage;
            } else {
                alert('A quilometragem n√£o pode ser menor que a anterior.');
                document.getElementById('currentMileage').value = vehicles[vehicleIndex].mileage;
                return;
            }
            
            saveVehiclesToStorage();
            updateStats();
            updateMaintenanceAlerts();
            
            alert('Informa√ß√µes salvas com sucesso!');
        }

        // Resetar hist√≥rico do ve√≠culo
        function resetVehicleHistory() {
            if (!currentVehicleId) return;
            
            // Filtrar servi√ßos, mantendo apenas os de outros ve√≠culos
            services = services.filter(service => service.vehicleId !== currentVehicleId);
            
            // Salvar altera√ß√µes
            localStorage.setItem('motoServices', JSON.stringify(services));
            
            // Fechar o modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('resetConfirmModal'));
            modal.hide();
            
            // Atualizar a interface
            updateServicesList();
            updateStats();
            updateMaintenanceAlerts();
            updateRecentServices();
            
            alert('Hist√≥rico resetado com sucesso!');
        }

        // Salvar ve√≠culos no localStorage
        function saveVehiclesToStorage() {
            localStorage.setItem('motoVehicles', JSON.stringify(vehicles));
        }

        // Adicionar servi√ßo a partir do formul√°rio principal
	async function addServiceFromForm() {
  	  const type = document.getElementById('serviceType').value;
 	  const date = document.getElementById('serviceDate').value;
  	  const mileage = document.getElementById('serviceMileage').value;
  	  const cost = document.getElementById('serviceCost').value;
	  const notes = document.getElementById('serviceNotes').value;

	  if (!type || !date || !mileage) {
    	   alert('Por favor, preencha todos os campos obrigat√≥rios.');
    	   return;
  	  }

	  // üîÑ Envia para o backend (Render)
  	   const result = await apiRequest('/services', {
 	    method: 'POST',
	    body: JSON.stringify({
      		vehicle_id: currentVehicleId,
      		description: type,
      		date,
      		cost: cost ? parseFloat(cost) : 0,
      		mileage: parseInt(mileage),
      		notes
    	 }),
  	});

	  if (result && result.ok) {
    	   alert('Servi√ßo registrado com sucesso!');
    	   await loadServicesFromAPI(currentVehicleId);
  	} else {
    	  alert(result?.data?.error || 'Erro ao salvar servi√ßo');
  	}

	 // Limpar o formul√°rio
  	document.getElementById('serviceForm').reset();
  	document.getElementById('serviceDate').value = new Date().toISOString().split('T')[0];
	}

	// Adicionar servi√ßo a partir do modal mobile
	async function addServiceFromMobile() {
  	  const type = document.getElementById('mobileServiceType').value;
  	  const date = document.getElementById('mobileServiceDate').value;
  	  const mileage = document.getElementById('mobileServiceMileage').value;
  	  const cost = document.getElementById('mobileServiceCost').value;

	  if (!type || !date || !mileage) {
    	   alert('Por favor, preencha todos os campos obrigat√≥rios.');
    	   return;
  	}

    const result = await apiRequest('/services', {
  	method: 'POST',
    	body: JSON.stringify({
         vehicle_id: currentVehicleId,
         description: type,
         date,
         cost: cost ? parseFloat(cost) : 0,
         mileage: parseInt(mileage),
         notes: ''
      }),
    });

	  if (result && result.ok) {
    		alert('Servi√ßo registrado com sucesso!');
    		await loadServicesFromAPI(currentVehicleId);
  		} else {
    		alert(result?.data?.error || 'Erro ao salvar servi√ßo');
  	}

	  // Fechar o modal e limpar
	  const modal = bootstrap.Modal.getInstance(document.getElementById('addServiceModal'));
  	  modal.hide();

	  document.getElementById('mobileServiceForm').reset();
  	  document.getElementById('mobileServiceDate').value = new Date().toISOString().split('T')[0];
	}
	
	// Fun√ß√£o auxiliar para carregar servi√ßos do banco
	async function loadServicesFromAPI(vehicleId) {
	  const result = await apiRequest(`/services/${vehicleId}`);
	  if (result && result.ok) {
	    services = result.data;
	    updateServicesList();
  	  } else {
    	   console.error(result?.data?.error || 'Erro ao carregar servi√ßos');
  	 }
	}


        // Fun√ß√£o principal para adicionar servi√ßo
        function addService(type, date, mileage, cost, notes) {
            const newService = {
                id: Date.now().toString(),
                vehicleId: currentVehicleId,
                type: type,
                date: date,
                mileage: parseInt(mileage),
                cost: cost ? parseFloat(cost) : 0,
                notes: notes
            };
            
            services.push(newService);
            localStorage.setItem('motoServices', JSON.stringify(services));
            
            // Atualizar a quilometragem atual se for maior que a atual
            const vehicleIndex = vehicles.findIndex(v => v.id === currentVehicleId);
            if (vehicleIndex !== -1 && parseInt(mileage) > vehicles[vehicleIndex].mileage) {
                vehicles[vehicleIndex].mileage = parseInt(mileage);
                document.getElementById('currentMileage').value = mileage;
                saveVehiclesToStorage();
            }
            
            updateServicesList();
            updateStats();
            updateMaintenanceAlerts();
            updateRecentServices();
            
            alert('Servi√ßo registrado com sucesso!');
        }

        // Atualizar a lista de servi√ßos
        function updateServicesList() {
            const servicesList = document.getElementById('servicesList');
            servicesList.innerHTML = '';
            
            const vehicleServices = services
                .filter(service => service.vehicleId === currentVehicleId)
                .sort((a, b) => b.mileage - a.mileage);
            
            if (vehicleServices.length === 0) {
                servicesList.innerHTML = '<p class="text-center text-muted">Nenhum servi√ßo registrado para este ve√≠culo.</p>';
                return;
            }
            
            vehicleServices.forEach(service => {
                const serviceDate = new Date(service.date).toLocaleDateString('pt-BR');
                
                const serviceItem = document.createElement('div');
                serviceItem.className = 'list-group-item service-item';
                serviceItem.innerHTML = `
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${service.type}</h6>
                        <small>${service.mileage} km</small>
                    </div>
                    <p class="mb-1">${service.notes || 'Sem observa√ß√µes'}</p>
                    <div class="d-flex justify-content-between">
                        <small>${serviceDate}</small>
                        <strong>R$ ${service.cost.toFixed(2)}</strong>
                    </div>
                `;
                
                servicesList.appendChild(serviceItem);
            });
        }

        // Atualizar alertas de manuten√ß√£o
        function updateMaintenanceAlerts() {
            const alertsContainer = document.getElementById('maintenanceAlerts');
            alertsContainer.innerHTML = '';
            
            const vehicle = vehicles.find(v => v.id === currentVehicleId);
            if (!vehicle) return;
            
            const vehicleServices = services.filter(service => service.vehicleId === currentVehicleId);
            const currentMileage = vehicle.mileage;
            
            // Agrupar servi√ßos por tipo e pegar o mais recente de cada tipo
            const lastServicesByType = {};
            vehicleServices.forEach(service => {
                if (!lastServicesByType[service.type] || service.mileage > lastServicesByType[service.type].mileage) {
                    lastServicesByType[service.type] = service;
                }
            });
            
            // Verificar necessidades de manuten√ß√£o para cada tipo de servi√ßo
            let hasAlerts = false;
            
            for (const [type, interval] of Object.entries(maintenanceConfig)) {
                if (interval === 0) continue; // Pular servi√ßos sem intervalo definido
                
                const lastService = lastServicesByType[type];
                const nextServiceMileage = lastService ? lastService.mileage + interval : interval;
                const mileageLeft = nextServiceMileage - currentMileage;
                
                if (mileageLeft <= 0) {
                    // Manuten√ß√£o atrasada
                    alertsContainer.innerHTML += `
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            <strong>${type}</strong> est√° atrasada - recomendado a cada ${interval.toLocaleString()} km
                        </div>
                    `;
                    hasAlerts = true;
                } else if (mileageLeft <= interval * 0.2) {
                    // Manuten√ß√£o pr√≥xima (20% ou menos da vida √∫til)
                    alertsContainer.innerHTML += `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>${type}</strong> est√° pr√≥xima (${mileageLeft.toLocaleString()} km restantes) - recomendado a cada ${interval.toLocaleString()} km
                        </div>
                    `;
                    hasAlerts = true;
                }
            }
            
            if (!hasAlerts) {
                alertsContainer.innerHTML = '<p class="text-center text-muted">Nenhuma manuten√ß√£o pr√≥xima necess√°ria.</p>';
            }
        }

        // Atualizar servi√ßos recentes na aba inicial
        function updateRecentServices() {
            const recentContainer = document.getElementById('recentServices');
            recentContainer.innerHTML = '';
            
            const vehicleServices = services
                .filter(service => service.vehicleId === currentVehicleId)
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 5); // √öltimos 5 servi√ßos
            
            if (vehicleServices.length === 0) {
                recentContainer.innerHTML = '<p class="text-center text-muted">Nenhum servi√ßo registrado.</p>';
                return;
            }
            
            const listGroup = document.createElement('ul');
            listGroup.className = 'list-group';
            
            vehicleServices.forEach(service => {
                const serviceDate = new Date(service.date).toLocaleDateString('pt-BR');
                
                const listItem = document.createElement('li');
                listItem.className = 'list-group-item d-flex justify-content-between align-items-center';
                listItem.innerHTML = `
                    ${service.type}
                    <span class="badge bg-primary rounded-pill">${service.mileage.toLocaleString()} km</span>
                    <small class="text-muted">${serviceDate}</small>
                `;
                
                listGroup.appendChild(listItem);
            });
            
            recentContainer.appendChild(listGroup);
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            const vehicle = vehicles.find(v => v.id === currentVehicleId);
            if (!vehicle) return;
            
            const vehicleServices = services.filter(service => service.vehicleId === currentVehicleId);
            const totalServices = vehicleServices.length;
            const totalCost = vehicleServices.reduce((sum, service) => sum + service.cost, 0);
            
            document.getElementById('totalMileage').textContent = vehicle.mileage.toLocaleString();
            document.getElementById('totalServices').textContent = totalServices;
            document.getElementById('totalCost').textContent = `R$ ${totalCost.toFixed(2)}`;
            
            // Calcular m√©dia mensal (considerando √∫ltimos 6 meses)
            const sixMonthsAgo = new Date();
            sixMonthsAgo.setMonth(sixMonthsAgo.getMonth() - 6);
            
            const recentServices = vehicleServices.filter(service => {
                return new Date(service.date) >= sixMonthsAgo;
            });
            
            const recentCost = recentServices.reduce((sum, service) => sum + service.cost, 0);
            const monthlyAverage = recentCost / 6;
            
            document.getElementById('monthlyAverage').textContent = `R$ ${monthlyAverage.toFixed(2)}`;
            
            // Calcular pr√≥xima revis√£o baseada no √∫ltimo servi√ßo de revis√£o geral
            const lastGeneralService = vehicleServices
                .filter(service => service.type === "Revis√£o geral")
                .sort((a, b) => b.mileage - a.mileage)[0];
            
            let nextMaintenance = 0;
            if (lastGeneralService) {
                nextMaintenance = lastGeneralService.mileage + maintenanceConfig["Revis√£o geral"];
            } else if (vehicleServices.length > 0) {
                // Se n√£o houver revis√£o geral, usar o servi√ßo mais recente + intervalo padr√£o
                const lastService = vehicleServices.sort((a, b) => b.mileage - a.mileage)[0];
                nextMaintenance = lastService.mileage + 10000;
            } else {
                // Se n√£o houver servi√ßos, usar a quilometragem atual + intervalo padr√£o
                nextMaintenance = vehicle.mileage + 10000;
            }
            
            document.getElementById('nextMaintenance').textContent = `${nextMaintenance.toLocaleString()} km`;
            
            // Atualizar gr√°fico de custos
            updateCostChart(vehicleServices);
        }

        // Atualizar gr√°fico de custos
        function updateCostChart(vehicleServices) {
            const ctx = document.getElementById('costChart').getContext('2d');
            
            // Agrupar custos por tipo de servi√ßo
            const costByType = {};
            vehicleServices.forEach(service => {
                if (!costByType[service.type]) {
                    costByType[service.type] = 0;
                }
                costByType[service.type] += service.cost;
            });
            
            // Preparar dados para o gr√°fico
            const labels = Object.keys(costByType);
            const data = Object.values(costByType);
            
            // Destruir gr√°fico existente se houver
            if (costChart) {
                costChart.destroy();
            }
            
            // Criar novo gr√°fico
            costChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Custo por tipo de servi√ßo (R$)',
                        data: data,
                        backgroundColor: chartColors.slice(0, labels.length),
                        borderColor: 'rgb(0, 100, 0)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value;
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Manipular busca de servi√ßos
        function handleSearch(e) {
            const searchTerm = e.target.value.toLowerCase();
            const serviceItems = document.querySelectorAll('.service-item');
            
            serviceItems.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Alternar modo de alto contraste
        function toggleContrastMode() {
            document.body.classList.toggle('high-contrast');
            const isHighContrast = document.body.classList.contains('high-contrast');
            localStorage.setItem('highContrast', isHighContrast);
        }

               // Fun√ß√£o para alternar entre abas
        function switchTab(tabName) {
            const tab = document.querySelector(`#${tabName}-tab`);
            if (tab) {
                const tabInstance = new bootstrap.Tab(tab);
                tabInstance.show();
            }
        }
  
    </script>
</body>
</html>
